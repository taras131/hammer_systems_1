(this.webpackJsonpemilus=this.webpackJsonpemilus||[]).push([[18],{552:function(e,t,i){"use strict";i.r(t);var n=i(0),c=i(568),r=i(571),l=i(570);const s="box";var a=i(63),o=i(40),d=i(261),j=i(4);const b={width:"100%",height:"100%",objectFit:"cover"};var p=Object(n.memo)((e=>{let{id:t,left:i,top:c,title:r,width:p,height:h,hideSourceOnDrag:x,isRotate:O,img:g,isStarting:u=!1,handleRemoveClick:f}=e;const m=Object(o.c)(),[v,y]=Object(n.useState)({x:0,y:0}),[{isDragging:k},w]=Object(l.a)((()=>({type:s,item:{id:t,left:i,top:c,width:p,height:h,mouse:v},collect:e=>({isDragging:e.isDragging()})})),[t,i,c,v,p,h]),C={width:p,height:h,left:i,top:c,cursor:"move",position:u?"relative":" absolute",opacity:k&&!u?0:1};return k&&x?Object(j.jsx)("div",{ref:w}):Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"box",ref:w,style:C,onMouseMove:e=>{const t=e.nativeEvent.offsetX,i=e.nativeEvent.offsetY;y({x:t,y:i})},onDoubleClick:()=>{u||m(Object(a.h)(t))},"data-testid":"box",children:[Object(j.jsx)("img",{src:O?g.rotate:g.noRotate,alt:"furniture",style:b}),!u&&Object(j.jsx)("div",{style:{position:"absolute",right:"3px",top:"2px",cursor:"pointer"},onClick:f,children:Object(j.jsx)(d.a,{style:{color:"blue"}})})]}),u&&Object(j.jsx)("span",{children:r})]})}));const h=e=>e.planner.activeElements;var x=i(155),O=i(96),g=i(116),u=i(109),f=i(207),m=i(129),v=i(554);var y=e=>{let{plan:t,handlePlanClick:i,isActive:n,handleRemoveClick:c}=e;return Object(j.jsxs)("li",{onClick:()=>i(t.id),style:{color:n?"white":"blue",padding:"15px",border:"1px solid white",margin:"10px 10px 0 0",cursor:"pointer",listStyle:"none",borderRadius:"20px",backgroundColor:n?"blue":"white",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[Object(j.jsx)("span",{children:t.title}),Object(j.jsx)(f.a,{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",children:Object(j.jsx)(m.a,{onClick:c,type:"primary",shape:"circle",icon:Object(j.jsx)(v.a,{})})})]},t.id)};const k={height:"270px",overflowY:"scroll",margin:"0",paddingLeft:"0",backgroundColor:"whitesmoke",padding:"10px"},w={display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"20px"},C={padding:"8px 12px",borderRadius:"20px",outline:"none",border:"1px solid blue"};var R=Object(n.memo)((()=>{const e=Object(o.c)(),[t,i]=Object(n.useState)(""),[c,r]=Object(n.useState)([]),l=Object(o.d)((e=>h(e))),s=Object(o.d)((e=>(e=>e.planner.loading)(e))),d=Object(o.d)((e=>(e=>e.planner.message)(e))),b=async i=>{i.preventDefault();let n=null;c.length&&(n=c.filter((e=>e.title===t))[0]);const r={elements:{...l},title:t};n&&n.id?e(Object(a.d)(r,n.id)):e(Object(a.b)(r))},p=t=>()=>{e(Object(a.c)(t))};Object(n.useEffect)((()=>{e(Object(a.j)(!0));const t=Object(O.g)(Object(O.b)(x.a,u.b)),i=Object(O.f)(t,(t=>{const i=[];try{t.forEach((e=>{i.push({...e.data(),id:e.id})})),r(i)}catch(n){alert(n)}finally{e(Object(a.j)(!1))}}));return()=>i()}),[e]),Object(n.useEffect)((()=>{d&&alert(d)}),[d]);const f=c.map((n=>{return Object(j.jsx)(y,{handlePlanClick:(r=n.id,()=>{const t=c.filter((e=>e.id===r))[0];e(Object(a.i)(t.elements)),i(t.title)}),plan:n,handleRemoveClick:p(n.id),isActive:n.title===t},n.id);var r}));return s?Object(j.jsx)(g.a,{}):Object(j.jsxs)("div",{style:{height:"100%",padding:"10px 20px",backgroundColor:"whitesmoke"},children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"}),Object(j.jsx)("ul",{style:k,children:f})]}),Object(j.jsxs)("form",{onSubmit:b,style:w,children:[Object(j.jsx)("input",{type:"text",value:t,onChange:e=>{i(e.currentTarget.value)},style:C}),Object(j.jsx)(m.a,{type:"primary",onClick:b,disabled:!t.length||!Object.keys(l).length,children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]})}));const S={height:"400px",width:"100%",position:"relative",border:"1px solid green",backgroundColor:"white",backgroundImage:"linear-gradient(to right, whitesmoke 1px, transparent 1px),linear-gradient(to bottom, whitesmoke 1px, transparent 1px)",backgroundSize:" 20px 20px"};var D=e=>{let{hideSourceOnDrag:t}=e;const i=Object(o.c)(),c=Object(n.useRef)(null),l=Object(o.d)((e=>h(e))),d=(e,t,i,n)=>{const r={finalX:e,finalY:t},l=c.current.offsetWidth,s=c.current.offsetHeight;return e<0&&(r.finalX=0),t<0&&(r.finalY=0),e+n>l&&(r.finalX=l-n),t+i>s&&(r.finalY=s-i),r},[,b]=Object(r.a)((()=>({accept:s,drop(e,t){if(e.id<1e3){const n=t.getClientOffset();if(n&&c.current){const t=c.current.getBoundingClientRect(),r=t.left+window.pageXOffset,l=t.top+window.pageYOffset,s=n.x,o=n.y,j=c.current.scrollLeft,b=c.current.scrollTop,p=s-r+j-e.mouse.x,h=o-l+b-e.mouse.y,{finalX:x,finalY:O}=d(p,h,e.height,e.width);i(Object(a.a)(e.id,(new Date).getTime(),x,O))}}else{const n=t.getDifferenceFromInitialOffset(),c=Math.round(e.left+n.x),r=Math.round(e.top+n.y),{finalX:l,finalY:s}=d(c,r,e.height,e.width);i(Object(a.f)(e.id,l,s))}}})),[]),x=Object.keys(l).map((e=>{return Object(j.jsx)(p,{...l[e],handleRemoveClick:(t=l[e].id,()=>{i(Object(a.g)(t))})},e);var t}));return Object(j.jsxs)("div",{ref:c,style:{display:"grid",gridTemplateColumns:"1fr 350px",gap:"20px"},children:[Object(j.jsx)("div",{ref:b,style:S,children:x}),Object(j.jsx)(R,{})]})};var Y=Object(n.memo)((()=>{const e=Object(o.d)((e=>(e=>e.planner.startElements)(e))).map((e=>Object(j.jsx)(p,{...e,isStarting:!0},e.id)));return Object(j.jsx)("div",{style:{height:"200px",backgroundColor:"whitesmoke",marginTop:"20px",padding:"20px"},children:Object(j.jsx)("div",{style:{display:"flex",alignItems:"end",gap:"40px"},children:e})})}));t.default=()=>Object(j.jsxs)(c.a,{children:[Object(j.jsx)("h3",{children:"Planner"}),Object(j.jsx)(D,{}),Object(j.jsx)("p",{children:"\u041a\u043b\u0438\u043a\u043d\u0435\u0442\u0435 \u043f\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 \u0434\u0432\u0430\u0436\u0434\u044b, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0435\u0433\u043e."}),Object(j.jsx)(Y,{}),Object(j.jsx)("p",{children:"\u0427\u0442\u043e\u0431\u044b \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0432 \u043f\u043b\u0430\u043d, \u043f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0435\u0433\u043e \u043c\u044b\u0448\u043a\u043e\u0439."})]})}}]);
//# sourceMappingURL=18.82b7a405.chunk.js.map